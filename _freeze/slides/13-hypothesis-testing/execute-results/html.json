{
  "hash": "24243d078d4d9fb086c494eded250806",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Hypothesis testing\nsubtitle: Lecture 13\nformat:\n  revealjs: default\neditor_options:\n  chunk_output_type: console\nexecute:\n  warning: false\n  error: false\n---\n\n## Setup\n\n::: {#3931b385 .cell execution_count=1}\n``` {.python .cell-code}\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom scipy.stats import norm\nimport random\n\nsns.set(font_scale=2)\nsns.set_theme(style = \"whitegrid\")\n```\n:::\n\n\n# Hypothesis testing\n\n## How can we answer questions using statistics? {.smaller}\n\n::: question\n**Statistical hypothesis testing** is the procedure that assesses evidence provided by the data in favor of or against some claim about the population (often about a population parameter or potential associations)\n:::\n\n## The hypothesis testing framework {.smaller}\n\n![](images/pius.jpg){fig-align=\"center\" width=\"40%\"}\n\n::: question\n*Ei incumbit probatio qui dicit, non qui negat*\n:::\n\n## The hypothesis testing framework {.smaller}\n\n::: incremental\n1.  Start with two hypotheses about the population: the null hypothesis and the alternative hypothesis.\n2.  Choose a (representative) sample, collect data, and analyze the data.\n3.  Figure out how likely it is to see data like what we observed, **IF** the null hypothesis were in fact true.\n4.  If our data would have been extremely unlikely if the null claim were true, then we reject it and deem the alternative claim worthy of further study. Otherwise, we cannot reject the null claim.\n:::\n\n## Organ donation consultants\n\n![](images/agnew_clinic.jpg){fig-align=\"center\"}\n\n<!-- People providing an organ for donation sometimes seek the help of a special  -->\n\n<!-- medical consultant. These consultants assist the patient in all aspects of the  -->\n\n<!-- surgery, with the goal of reducing the possibility of complications during the  -->\n\n<!-- medical procedure and recovery. Patients might choose a consultant based in part  -->\n\n<!-- on the historical complication rate of the consultant's clients. -->\n\n## Organ donation consultants {.smaller}\n\nOne consultant tried to attract patients by noting that the average complication rate for liver donor surgeries in the US is about 10%, but her clients have only had 3 complications in the 62 liver donor surgeries she has facilitated.\nShe claims this is strong evidence that her work meaningfully contributes to reducing complications (and therefore she should be hired!).\n\n::: fragment\n::: question\nIs this a reasonable claim to make?\n:::\n:::\n\n## Organ donation consultants\n\n![](images/vigen.png){fig-align=\"center\"}\n\n## Organ donation consultants {.smaller}\n\nOne consultant tried to attract patients by noting that the average complication rate for liver donor surgeries in the US is about 10%, but her clients have only had 3 complications in the 62 liver donor surgeries she has facilitated.\nShe claims this is strong evidence that her work meaningfully contributes to reducing complications (and therefore she should be hired!).\n\n::: fragment\n::: question\nIs there sufficient evidence to suggest that her complication rate is lower than the overall US rate?\n:::\n:::\n\n## The hypothesis testing framework {.smaller}\n\n::: incremental\n1.  Start with two hypotheses about the population: the null hypothesis and the alternative hypothesis.\n\n2.  Choose a (representative) sample, collect data, and analyze the data.\n\n3.  Figure out how likely it is to see data like what we observed, **IF** the null hypothesis were in fact true.\n\n4.  If our data would have been extremely unlikely if the null claim were true, then we reject it and deem the alternative claim worthy of further study.\n    Otherwise, we cannot reject the null claim.\n:::\n\n## Two competing hypotheses {.smaller}\n\nThe null hypothesis (often denoted $H_0$) states that \"nothing unusual is happening\" or \"there is no relationship,\" etc.\n\n::: fragment\nOn the other hand, the alternative hypothesis (often denoted $H_1$ or $H_A$) states the opposite: that there *is* some sort of relationship.\n:::\n\n::: fragment\n::: question\nIn statistical hypothesis testing we **always** first assume that the null hypothesis is true and then evaluate the weight of proof we have against this claim.\n:::\n:::\n\n## 1. Defining the hypotheses {.smaller}\n\nThe null and alternative hypotheses are defined for **parameters**.\n\n::: question\nWhat will our null and alternative hypotheses be for this example?\n:::\n\n::: fragment\n::: incremental\n-   $H_0$: the true proportion of complications among her patients is equal to the US population rate\n-   $H_1$: the true proportion of complications among her patients is **less** than the US population rate\n:::\n:::\n\n::: fragment\nExpressed in symbols:\n\n-   $H_0: p = 0.10$\n-   $H_1: p < 0.10$\n:::\n\n::: fragment\nwhere $p$ is the true proportion of transplants with complications among her patients.\n:::\n\n## 2. Collecting and summarizing data {.smaller}\n\nWith these two hypotheses, we now take our sample and summarize the data.\n\nThe choice of summary statistic calculated depends on the type of data.\nIn our example, we use the sample proportion: $\\widehat{p} = 3/62 \\approx 0.048$:\n\n## 3. Assessing the evidence observed {.smaller}\n\nNext, we calculate the probability of getting data like ours, *or more extreme*, if $H_0$ were in fact actually true.\n\n::: fragment\nThis is a conditional probability:\n\n> Given that $H_0$ is true (i.e., if $p$ were *actually* 0.10), what would be the probability of observing $\\widehat{p} = 3/62$?\"\n:::\n\n::: fragment\n::: question\nThis probability is known as the **p-value**.\n:::\n:::\n\n## 3. Assessing the evidence observed {.smaller}\n\nLet's simulate a distribution for $\\hat{p}$ such that the probability of complication for each patient is 0.10 for 62 patients.\n\nThis **null distribution** for $\\hat{p}$ represents the distribution of the observed proportions we might expect, if the null hypothesis were true.\n\n::: fragment\n::: question\nWhen sampling from the null distribution, what is the expected proportion of complications?\nWhat would the expected count be of patients experiencing complications?\n:::\n:::\n\n## 3. Assessing the evidence observed {.smaller}\n\n::: {#28c3dcb0 .cell execution_count=2}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-3-output-1.png){width=783 height=435}\n:::\n:::\n\n\n## 3. Assessing the evidence observed {.smaller}\n\n::: {#9592bc03 .cell execution_count=3}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-4-output-1.png){width=783 height=435}\n:::\n:::\n\n\n## 3. Assessing the evidence observed {.smaller}\n\n::: {#e955ccb8 .cell execution_count=4}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-5-output-1.png){width=783 height=435}\n:::\n:::\n\n\n## 3. Assessing the evidence observed {.smaller}\n\n::: {#01abd5d2 .cell execution_count=5}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-6-output-1.png){width=783 height=435}\n:::\n:::\n\n\n## 3. Assessing the evidence observed {.smaller}\n\nSupposing that the true proportion of complications is 10%, if we were to take repeated samples of 62 liver transplants, about 11.5% of them would have 3 or fewer complications.\n\n::: fragment\nThat is, **p = 0.115**.\n:::\n\n## 4. Making a conclusion {.smaller}\n\nIf it is very unlikely to observe our data (or more extreme) if $H_0$ were actually true, then that might give us enough evidence to suggest that it is actually false (and that $H_1$ is true).\n\n::: fragment\nWhat is \"small enough\"?\n:::\n\n::: incremental\n-   We often consider a numeric cutpoint (the **significance level**) defined *prior* to conducting the analysis.\n\n-   Many analyses use $\\alpha = 0.05$.\n    This means that if $H_0$ were in fact true, we would expect to make the wrong decision only 5% of the time.\n:::\n\n::: fragment\nIf the p-value is less than $\\alpha$, we say the results are **statistically significant**.\nIn such a case, we would make the decision to **reject the null hypothesis**.\n:::\n\n## What do we conclude when $p \\ge \\alpha$? {.smaller}\n\nIf the p-value is $\\alpha$ or greater, we say the results are not statistically significant and we **fail to reject the null hypothesis**.\n\n::: fragment\nImportantly, we never \"accept\" the null hypothesis -- we performed the analysis assuming that $H_0$ was true to begin with and assessed the probability of seeing our observed data or more extreme under this assumption.\n:::\n\n## 4. Making a conclusion {.smaller}\n\n::: question\nThere is *insufficient* evidence at $\\alpha = 0.05$ to suggest that the consultant's complication rate is less than the US average.\n:::\n\n## Vacation rentals in Tucson, AZ {.smaller}\n\n![](images/tucson.jpg){fig-align=\"center\"}\n\n::: question\nYour friend claims that the mean price per guest per night for Airbnbs in Tucson, AZ is \\$100.\nWhat do you make of this statement?\n:::\n\n## 1. Defining the hypotheses {.smaller}\n\nRemember, the null and alternative hypotheses are defined for **parameters,** not statistics\n\n::: question\nWhat will our null and alternative hypotheses be for this example?\n:::\n\n::: incremental\n-   $H_0$: the true mean price per guest is \\$100 per night\n\n-   $H_1$: the true mean price per guest is NOT \\$100 per night\n:::\n\n::: fragment\nExpressed in symbols:\n\n-   $H_0: \\mu = 100$\n-   $H_1: \\mu \\neq 100$\n\nwhere $\\mu$ is the true population mean price per guest per night among Airbnb listings in Tucson.\n:::\n\n## 2. Collecting and summarizing data {.smaller}\n\nWith these two hypotheses, we now take our sample and summarize the data.\nWe have a representative of 50 Airbnb listings in the file `tucson.csv`.\n\nThe choice of summary statistic calculated depends on the type of data.\nIn our example, we use the sample proportion, $\\bar{x} = 116.24$.\n\n::: fragment\n\n::: {#5490d197 .cell execution_count=6}\n``` {.python .cell-code}\ntucson = pd.read_csv('data/tucson.csv')\n\nmean_price = tucson['ppg'].mean()\nprint(f\"Sample mean price: {mean_price:.2f}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSample mean price: 116.24\n```\n:::\n:::\n\n\n:::\n\n## 3. Assessing the evidence observed {.smaller}\n\nWe know that not every representative sample of 50 Airbnb listings in Tucson will have exactly a sample mean of exactly \\$116.24.\n\n::: question\nHow might we deal with this **variability** in the **sampling distribution of the mean** using only the data that we have from our original sample?\n:::\n\n::: fragment\nWe can take **bootstrap samples**, formed by sampling *with replacement* from our original dataset, *of the same sample size* as our original dataset.\n:::\n\n## 3. Assessing the evidence observed\n\n::: {#8c59ad18 .cell execution_count=7}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-8-output-1.png){width=824 height=455}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nMean price per guest per night: 116.24\n```\n:::\n:::\n\n\n## 3. Assessing the evidence observed\n\n::: {#e380c93a .cell execution_count=8}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-9-output-1.png){width=824 height=455}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nMean price per guest per night (Bootstrap 1): 115.20\n```\n:::\n:::\n\n\n## 3. Assessing the evidence observed\n\n::: {#0908f199 .cell execution_count=9}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-10-output-1.png){width=824 height=455}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nMean price per guest per night (Bootstrap 2): 115.08\n```\n:::\n:::\n\n\n## 3. Assessing the evidence observed\n\n::: {#e4f5cd3d .cell execution_count=10}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-11-output-1.png){width=824 height=455}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nMean price per guest per night (Bootstrap 3): 103.20\n```\n:::\n:::\n\n\n## 3. Assessing the evidence observed\n\n::: {#0e300624 .cell execution_count=11}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-12-output-1.png){width=833 height=455}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nMean of bootstrap means: 116.24\n```\n:::\n:::\n\n\n## Shifting the distribution {.smaller}\n\nWe've captured the variability in the sample mean among samples of size 50 from Tucson area Airbnbs, but remember that in the hypothesis testing paradigm, we must assess our observed evidence *under the assumption that* $H_0$ *is true*.\n\n::: {#e0e52c89 .cell execution_count=12}\n``` {.python .cell-code}\nmean_price = bootstrap_means_df['boot_means'].mean()\nprint(f\"Sample mean price: {mean_price:.2f}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSample mean price: 116.24\n```\n:::\n:::\n\n\n<br>\n\n::: fragment\n::: question\nWhere should the bootstrap distribution of means be centered under $H_0$?\n:::\n:::\n\n## Shifting the distribution\n\n::: {#da3155e6 .cell execution_count=13}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-14-output-1.png){width=833 height=455}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nMean of bootstrap means: 116.24\n```\n:::\n:::\n\n\n## Shifting the distribution\n\n::: {#c6bac8ec .cell execution_count=14}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-15-output-1.png){width=833 height=455}\n:::\n:::\n\n\n## 3. Assessing the evidence observed\n\n::: {#7f98b358 .cell execution_count=15}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-16-output-1.png){width=833 height=455}\n:::\n:::\n\n\n## 3. Assessing the evidence observed\n\n::: {#fbe47af7 .cell execution_count=16}\n\n::: {.cell-output .cell-output-display}\n![](13-hypothesis-testing_files/figure-revealjs/cell-17-output-1.png){width=821 height=455}\n:::\n:::\n\n\n## 3. Assessing the evidence observed {.smaller}\n\nSupposing that the true mean price per guest were \\$100 a night, about 0.16% of bootstrap sample means were as extreme or even more so than our originally observed sample mean price per guest of \\$116.24.\n\n::: fragment\nThat is, **p = 0.0016**.\n:::\n\n## 4. Making a conclusion {.smaller}\n\nIf it is very unlikely to observe our data (or more extreme) if $H_0$ were actually true, then that might give us enough evidence to suggest that it is actually false (and that $H_1$ is true).\n\n::: question\nThere is sufficient evidence at $\\alpha = 0.05$ to suggest that the mean price per guest per night of Airbnb rentals in Tucson is not \\$100.\n:::\n\n## Ok, so what **isn't** a p-value? {.smaller}\n\n> *\"A p-value of 0.05 means the null hypothesis has a probability of only 5% of* *being true\"*\n\n> *\"A p-value of 0.05 means there is a 95% chance or greater that the null* *hypothesis is incorrect\"*\n\n::: fragment\n<center>[NO]{style=\"color:red;font-size:5rem;\"}</center>\n:::\n\n::: fragment\np-values do **not** provide information on the probability that the null hypothesis is true given our observed data.\n:::\n\n## What can go wrong? {.smaller}\n\nRemember, a p-value is calculated *assuming* that $H_0$ is true.\nIt cannot be used to tell us how likely that assumption is correct.\nWhen we fail to reject the null hypothesis, we are stating that there is **insufficient evidence** to assert that it is false.\nThis could be because...\n\n::: incremental\n-   ...\n    $H_0$ actually *is* true!\n\n-   ...\n    $H_0$ is false, but we got unlucky and happened to get a sample that didn't give us enough reason to say that $H_0$ was false.\n:::\n\n::: fragment\nEven more bad news, hypothesis testing does NOT give us the tools to determine which one of the two scenarios occurred.\n:::\n\n## What can go wrong? {.smaller}\n\nSuppose we test a certain null hypothesis, which can be either true or false (we never know for sure!).\nWe make one of two decisions given our data: either reject or fail to reject $H_0$.\n\n::: fragment\nWe have the following four scenarios:\n\n| Decision             | $H_0$ is true    | $H_0$ is false   |\n|----------------------|------------------|------------------|\n| Fail to reject $H_0$ | Correct decision | *Type II Error*  |\n| Reject $H_0$         | *Type I Error*   | Correct decision |\n\n::: incremental\n-   $\\alpha$ is the probability of making a Type I error.\n\n-   $\\beta$ is the probability of making a Type II error.\n\n-   The **power** of a test is 1 - $\\beta$: the probability that, if the null hypothesis is actually false, we correctly reject it.\n:::\n:::\n\n## `ae-09`\n\nWork through the Tucson Airbnb prices data in an exercise on **Quantifying uncertainty**\n\n",
    "supporting": [
      "13-hypothesis-testing_files/figure-revealjs"
    ],
    "filters": [],
    "includes": {}
  }
}